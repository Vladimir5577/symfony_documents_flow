{% extends 'base_dashboard.html.twig' %}

{% block title %}Просмотр пользователя!{% endblock %}



{% block sidebar_list %}
    {% include 'sidebar/sidebar_list.html.twig' %}
{% endblock %}



{% block main %}
    {% for message in app.flashes('success') %}
        <div class="alert alert-success alert-dismissible fade show mb-4" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Просмотр пользователя</h1>
        <a href="{{ path('app_all_users', {page: page|default(1)}) }}" class="btn btn-secondary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Назад к списку
        </a>
    </div>

    <section class="section">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Информация о пользователе</h4>
                    </div>
                    <div class="card-content">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12">
                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <th class="text-muted" style="width: 30%;">ID:</th>
                                                <td><strong>{{ user.id }}</strong></td>
                                            </tr>
                                            <tr>
                                                <th class="text-muted">Фамилия:</th>
                                                <td>{{ user.lastname ?? '-' }}</td>
                                            </tr>
                                            <tr>
                                                <th class="text-muted">Имя:</th>
                                                <td>{{ user.firstname ?? '-' }}</td>
                                            </tr>
                                            <tr>
                                                <th class="text-muted">Отчество:</th>
                                                <td>{{ user.patronymic ?? '-' }}</td>
                                            </tr>
                                            <tr>
                                                <th class="text-muted">Логин:</th>
                                                <td><code>{{ user.login }}</code></td>
                                            </tr>
                                            <tr>
                                                <th class="text-muted">Телефон:</th>
                                                <td>{{ user.phone ?? '-' }}</td>
                                            </tr>
                                            <tr>
                                                <th class="text-muted">Статус:</th>
                                                <td>
                                                    {% if user.isActive %}
                                                        <span class="badge bg-success">Активен</span>
                                                    {% else %}
                                                        <span class="badge bg-danger">Неактивен</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th class="text-muted">Начальник:</th>
                                                <td>
                                                    {% if user.boss %}
                                                        {{ user.boss.lastname ?? '' }} {{ user.boss.firstname ?? '' }} {{ user.boss.patronymic ?? '' }}
                                                        <br><small class="text-muted">Логин: {{ user.boss.login }}</small>
                                                    {% else %}
                                                        <span class="text-muted">-</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th class="text-muted">Роли:</th>
                                                <td>
                                                    {% set roles = user.roles %}
                                                    {% if roles|length > 0 %}
                                                        {% for role in roles %}
                                                            <span class="badge bg-primary me-1">{{ role }}</span>
                                                        {% endfor %}
                                                    {% else %}
                                                        <span class="text-muted">Нет ролей</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% if worker %}
                                            <tr>
                                                <th class="text-muted">Профессия:</th>
                                                <td><strong>{{ worker.profession }}</strong></td>
                                            </tr>
                                            {% if worker.description %}
                                            <tr>
                                                <th class="text-muted">Описание:</th>
                                                <td>{{ worker.description }}</td>
                                            </tr>
                                            {% endif %}
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="d-flex justify-content-end gap-2 mt-4">

        <a href="{{ path('app_edit_user', {id: user.id}) }}" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Редактировать пользователя
        </a>

        {% if user.id != app.user.id %}
        <form id="delete-user-form" method="post" action="{{ path('app_delete_user', {id: user.id}) }}" class="d-inline">
            <input type="hidden" name="_csrf_token" value="{{ csrf_token('delete_user_' ~ user.id) }}">
            <button type="submit" class="btn btn-danger" id="delete-user-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
                Удалить пользователя
            </button>
        </form>
        {% endif %}

    </div>



    {% include 'user/partials/_script_alert_delete_user.html.twig' %}

{% endblock %}
